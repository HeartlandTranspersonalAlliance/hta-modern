---
import type { CallToAction } from '~/types';
import Button from '~/components/ui/Button.astro';

export interface Props {
  title?: string;
  subtitle?: string;
  tagline?: string;
  content?: string;
  callToAction?: string | CallToAction;
  callToAction2?: string | CallToAction;
}

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline,
  content = await Astro.slots.render('content'),
  callToAction = await Astro.slots.render('callToAction'),
  callToAction2 = await Astro.slots.render('callToAction2'),
} = Astro.props;

const condenseHeading = (value?: string) => {
  const trimmed = value?.trim();
  if (!trimmed) return trimmed;
  const words = trimmed
    .replace(/<[^>]+>/g, ' ')
    .trim()
    .split(/\s+/);
  return words.length > 3 ? words.slice(0, 3).join(' ') : trimmed;
};

const compactTitle = condenseHeading(typeof title === 'string' ? title : undefined);
---

<section class="relative not-prose">
  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 pt-6 md:pt-8 lg:pt-10">
    <div class="surface-panel border rounded-[2rem] p-6 md:p-10 lg:p-12 text-center">
      {
        tagline && (
          <p
            class="inline-block rounded-full px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-[0.24em] text-secondary dark:text-cyan-200 bg-white/55 dark:bg-slate-800/50 intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade"
            set:html={tagline}
          />
        )
      }

      {
        compactTitle && (
          <h1
            class="mt-4 mx-auto max-w-4xl text-4xl md:text-5xl lg:text-6xl font-semibold leading-[1.03] tracking-[-0.025em] font-heading text-heading intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade"
            set:html={compactTitle}
          />
        )
      }

      {
        subtitle && (
          <p
            class="mt-5 max-w-3xl mx-auto text-lg md:text-xl text-muted leading-relaxed intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade"
            set:html={subtitle}
          />
        )
      }

      {
        (callToAction || callToAction2) && (
          <div class="mt-7 max-w-xl mx-auto flex flex-col sm:flex-row sm:justify-center gap-3 sm:gap-4 intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade">
            {callToAction && (
              <div class="flex w-full sm:w-auto">
                {typeof callToAction === 'string' ? (
                  <Fragment set:html={callToAction} />
                ) : (
                  <Button variant="primary" {...callToAction} class="w-full sm:w-auto" />
                )}
              </div>
            )}
            {callToAction2 && (
              <div class="flex w-full sm:w-auto">
                {typeof callToAction2 === 'string' ? (
                  <Fragment set:html={callToAction2} />
                ) : (
                  <Button {...callToAction2} class="w-full sm:w-auto" />
                )}
              </div>
            )}
          </div>
        )
      }

      {content && <div class="mt-7" set:html={content} />}
    </div>
  </div>
</section>
