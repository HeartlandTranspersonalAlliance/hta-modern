---
import Image from '~/components/common/Image.astro';
import Button from '~/components/ui/Button.astro';

import type { Hero as Props } from '~/types';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline,

  content = await Astro.slots.render('content'),
  actions = await Astro.slots.render('actions'),
  image = await Astro.slots.render('image'),

  id,
  bg = await Astro.slots.render('bg'),
} = Astro.props;

const condenseHeading = (value?: string) => {
  const trimmed = value?.trim();
  if (!trimmed) return trimmed;
  const words = trimmed
    .replace(/<[^>]+>/g, ' ')
    .trim()
    .split(/\s+/);
  return words.length > 3 ? words.slice(0, 3).join(' ') : trimmed;
};

const compactTitle = condenseHeading(typeof title === 'string' ? title : undefined);
---

<section class="relative not-prose" {...id ? { id } : {}}>
  <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
    <slot name="bg">
      {bg ? <Fragment set:html={bg} /> : null}
    </slot>
  </div>

  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 pt-6 md:pt-8 lg:pt-10">
    <div class:list={['grid gap-8 lg:gap-12 items-center', { 'lg:grid-cols-[1.1fr_0.9fr]': image }]}>
      <div>
        {
          tagline && (
            <p
              class="inline-block rounded-full px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-[0.24em] text-secondary dark:text-cyan-200 bg-white/55 dark:bg-slate-800/50 intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade"
              set:html={tagline}
            />
          )
        }

        {
          compactTitle && (
            <h1
              class="mt-4 text-4xl md:text-5xl lg:text-6xl font-semibold leading-[1.03] tracking-[-0.025em] font-heading text-heading intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade"
              set:html={compactTitle}
            />
          )
        }

        {
          subtitle && (
            <p
              class="mt-5 text-lg md:text-xl text-muted leading-relaxed max-w-2xl intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade"
              set:html={subtitle}
            />
          )
        }

        {
          actions && (
            <div class="mt-7 max-w-xl flex flex-col sm:flex-row gap-3 sm:gap-4 intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade">
              {Array.isArray(actions) ? (
                actions.map((action) => (
                  <div class="flex w-full sm:w-auto">
                    <Button {...(action || {})} class="w-full sm:w-auto" />
                  </div>
                ))
              ) : (
                <Fragment set:html={actions} />
              )}
            </div>
          )
        }

        {content && <div class="mt-7" set:html={content} />}
      </div>

      {
        image && (
          <div class="intersect-once intersect-no-queue intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade">
            <div class="relative rounded-[2rem] overflow-hidden ring-1 ring-[var(--aw-border)] bg-black/10 shadow-[0_20px_55px_rgba(20,30,45,0.18)]">
              <div class="absolute inset-0 bg-gradient-to-tr from-black/12 to-transparent pointer-events-none" />
              {typeof image === 'string' ? (
                <Fragment set:html={image} />
              ) : (
                <Image
                  class="w-full h-full object-cover"
                  widths={[400, 768, 1024, 2040]}
                  sizes="(max-width: 767px) 400px, (max-width: 1023px) 768px, (max-width: 2039px) 1024px, 2040px"
                  loading="eager"
                  width={1024}
                  height={720}
                  {...image}
                />
              )}
            </div>
          </div>
        )
      }
    </div>
  </div>
</section>
