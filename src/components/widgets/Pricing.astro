---
import { Icon } from 'astro-icon/components';
import Button from '~/components/ui/Button.astro';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import type { Pricing as Props } from '~/types';

const {
  title = '',
  subtitle = '',
  tagline = '',
  prices = [],

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} />
  <div class="grid gap-4 md:gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {
      prices &&
        prices.map(({ title, subtitle, price, period, items, callToAction, hasRibbon = false, ribbonTitle }) => (
          <article class="relative surface-card border rounded-2xl p-6 md:p-7 flex flex-col h-full intersect-once motion-safe:md:intersect:animate-fade motion-safe:md:opacity-0 intersect-quarter">
            {hasRibbon && ribbonTitle && (
              <span class="absolute top-3 right-3 rounded-full px-3 py-1 text-[0.62rem] font-bold uppercase tracking-[0.16em] bg-primary text-white">
                {ribbonTitle}
              </span>
            )}

            {title && <h3 class="text-xl font-heading font-semibold uppercase tracking-[0.08em] mb-2">{title}</h3>}
            {subtitle && <p class="text-muted text-sm md:text-base">{subtitle}</p>}

            {price && period && (
              <div class="my-6">
                <div class="flex items-end gap-1">
                  <span class="text-2xl text-primary">$</span>
                  <span class="text-5xl font-heading font-semibold text-primary leading-none">{price}</span>
                </div>
                <span class="text-sm text-muted uppercase tracking-[0.15em]">{period}</span>
              </div>
            )}

            {items && (
              <ul class="space-y-2.5 flex-1">
                {items.map(
                  ({ description, icon }) =>
                    description && (
                      <li class="flex items-start gap-2.5">
                        <span class="rounded-full bg-primary/12 dark:bg-primary/22 p-1 mt-0.5">
                          <Icon name={icon ? icon : 'tabler:check'} class="w-4 h-4 text-primary" />
                        </span>
                        <span class="text-sm md:text-base text-default leading-relaxed">{description}</span>
                      </li>
                    )
                )}
              </ul>
            )}

            {callToAction && (
              <div class="mt-6 flex justify-start">
                {typeof callToAction === 'string' ? (
                  <Fragment set:html={callToAction} />
                ) : (
                  callToAction &&
                  callToAction.href && <Button {...(hasRibbon ? { variant: 'primary' } : {})} {...callToAction} />
                )}
              </div>
            )}
          </article>
        ))
    }
  </div>
</WidgetWrapper>
